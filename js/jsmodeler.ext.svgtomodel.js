/* JSModeler 0.40 - http://www.github.com/kovacsv/JSModeler */ 'use strict';JSM.SvgToModel=function(t,y,u,A){function B(a,h){function k(a,c,e,d,b){var f=a.createSVGPoint();f.x=d;f.y=b;a=f;e=e.getCTM();void 0!==e&&null!==e&&(a=f.matrixTransform(e));e=new JSM.Coord2D(a.x,a.y);d=new JSM.Coord2D(d,b);c=c.GetLastContour();b=c.VertexCount();if(0<b&&c.GetVertex(b-1).IsEqualWithEps(e,0.1))return d;c.AddVertex(a.x,a.y);return d}function r(a,c,e,d,b,f){var s=document.createElementNS("http://www.w3.org/2000/svg","path"),m="M "+d.x+" "+d.y+" ",h,g,l,n,p;for(h=0;h<b.length;h++)if(g=
b[h],g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL)l=g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?"C":"c",m+=l+" "+g.x1+" "+g.y1+" "+g.x2+" "+g.y2+" "+g.x+" "+g.y+" ";else if(g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL)l=g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?"Q":"q",m+=l+" "+g.x1+" "+g.y1+" "+g.x+" "+g.y+" ";else if(g.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||
g.pathSegType==SVGPathSeg.PATHSEG_ARC_REL)l=g.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS?"A":"a",n=g.largeArcFlag?1:0,p=g.sweepFlag?1:0,m+=l+" "+g.r1+" "+g.r2+" "+g.angle+" "+n+" "+p+" "+g.x+" "+g.y+" ";else if(g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL)l=g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS?"S":"s",m+=l+" "+g.x2+" "+g.y2+" "+g.x+" "+g.y+" ";s.setAttributeNS(null,"d",m);m=s.getTotalLength();b=0;0<e&&(b=
parseInt(m/e,10));3>b&&(b=3);e=m/b;for(m=1;m<=b;m++)d=s.getPointAtLength(m*e),d=k(a,f,c,d.x,d.y);return d}function l(a){a=a.GetLastContour();var c=a.VertexCount();if(0!==c){var b=a.GetVertex(0),c=a.GetVertex(c-1);b.IsEqualWithEps(c,0.1)&&a.vertices.pop()}}function n(a){0<a.GetLastContour().VertexCount()&&(l(a),a.AddContour())}var d=new JSM.ContourPolygon2D;d.AddContour();var b=document.createElementNS("http://www.w3.org/2000/svg","svg"),f;if(a instanceof SVGPathElement){var e=new JSM.Coord2D(0,0),
p=new JSM.Coord2D(0,0),q=h;a.hasAttribute("segmentlength")&&(q=parseFloat(a.getAttribute("segmentlength")));var c,s;for(f=0;f<a.pathSegList.numberOfItems;f++)if(c=a.pathSegList.getItem(f),c.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH)if(c.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)n(d),e=k(b,d,a,c.x,c.y),p=e.Clone();else if(c.pathSegType==SVGPathSeg.PATHSEG_MOVETO_REL)n(d),e=k(b,d,a,p.x+c.x,p.y+c.y),p=e.Clone();else if(c.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)e=k(b,d,a,c.x,c.y);else if(c.pathSegType==
SVGPathSeg.PATHSEG_LINETO_REL)e=k(b,d,a,e.x+c.x,e.y+c.y);else if(c.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS)e=k(b,d,a,c.x,e.y);else if(c.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS)e=k(b,d,a,e.x,c.y);else if(c.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL)e=k(b,d,a,e.x+c.x,e.y);else if(c.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL)e=k(b,d,a,e.x,e.y+c.y);else if(c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL||
c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL||c.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||c.pathSegType==SVGPathSeg.PATHSEG_ARC_REL||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){s=[];if(c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){for(;f<a.pathSegList.numberOfItems;f++){c=a.pathSegList.getItem(f);
if(!(c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||c.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL))break;s.push(c)}f-=1}else s.push(c);e=r(b,a,q,e,s,d)}l(d)}else if(a instanceof SVGRectElement)k(b,d,a,a.x.baseVal.value,a.y.baseVal.value),k(b,d,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value),k(b,d,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value+a.height.baseVal.value),k(b,d,a,a.x.baseVal.value,a.y.baseVal.value+a.height.baseVal.value);else if(a instanceof
SVGPolygonElement)for(f=0;f<a.points.numberOfItems;f++)e=a.points.getItem(f),k(b,d,a,e.x,e.y);d.color=function(a){for(var c="";null!==a&&void 0!==a&&0===c.length;)c=a.getAttribute("fill"),null===c&&(c=a.style.fill),a=a.parentElement;a=0;if(0===c.length)return a;if("#"==c[0])a=JSM.HexColorToRGBColor(c.substring(1));else{var b=c.indexOf("("),e=c.indexOf(")");if(-1==b||-1==e)return a;c=c.substring(b+1,e).split(", ");if(3!=c.length)return a;a=JSM.RGBComponentsToHexColor(c[0],c[1],c[2])}return a}(a);d.originalElem=
a;return d}function C(a,h,k){function r(a,b){var e=[],d,f;if(b==JSM.Orientation.Clockwise)for(d=0;d<a.VertexCount();d++)f=a.GetVertex(d),e.push(new JSM.Coord(f.x,0,-f.y));else for(d=a.VertexCount()-1;0<=d;d--)f=a.GetVertex(d),e.push(new JSM.Coord(f.x,0,-f.y));return e}function l(a,d,b){a.push(null);var e;if(b==JSM.Orientation.CounterClockwise)for(b=0;b<d.VertexCount();b++)e=d.GetVertex(b),a.push(new JSM.Coord(e.x,0,-e.y));else for(b=d.VertexCount()-1;0<=b;b--)e=d.GetVertex(b),a.push(new JSM.Coord(e.x,
0,-e.y))}var n=[],d=new JSM.Vector(0,-1,0);void 0!==a.originalElem&&a.originalElem.hasAttribute("modelheight")&&(h=parseFloat(a.originalElem.getAttribute("modelheight")));var b,f;f=a.ContourCount();if(1==f)f=a.GetContour(0).GetOrientation(),b=r(a.GetContour(0),f),b=JSM.GeneratePrism(b,d,h,!0,k),n.push(b);else if(1<f){f=a.GetContour(0).GetOrientation();var e=r(a.GetContour(0),f),p=!1,q;for(q=1;q<a.ContourCount();q++)b=a.GetContour(q).GetOrientation(),b==f?(b=r(a.GetContour(q),f),b=JSM.GeneratePrism(b,
d,h,!0,k),n.push(b)):(l(e,a.GetContour(q),b),p=!0);b=p?JSM.GeneratePrismWithHole(e,d,h,!0,k):JSM.GeneratePrism(e,d,h,!0,k);n.push(b)}a=new JSM.Material({ambient:a.color,diffuse:a.color});return[n,a]}var z=new JSM.Model,v=new JSM.Materials;u=function(a,h){function k(a,b,d){a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)d.push(a[b])}var r=[],l=[];k(a,"path",l);k(a,"rect",l);k(a,"polygon",l);var n=h;a.hasAttribute("segmentlength")&&(n=parseFloat(a.getAttribute("segmentlength")));var d,b;for(d=0;d<
l.length;d++)b=B(l[d],n),r.push(b);return r}(t,u);t.hasAttribute("modelheight")&&(y=parseFloat(t.getAttribute("modelheight")));var h,w,x;for(t=0;t<u.length;t++){h=C(u[t],y,A);w=h[0];h=h[1];v.AddMaterial(h);for(h=0;h<w.length;h++)x=w[h],x.SetPolygonsMaterialIndex(v.Count()-1),z.AddBody(x)}return[z,v]};
